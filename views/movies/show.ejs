<% include ../partials/header %>

<div class="movies-show">
    <div class="composition">
        <div class="composition__title">
            <h1><%= movie.title %></h1>
        </div>
        <div class="composition__body">
            <p><%= movie.description %></p>
            <p class="composition__author">Submitted By: <a class="u-text-decoration u-color-grey-light" href="/users/<%= movie.author.id %>"><%= movie.author.username %></a>, <%= moment(movie.createdAt).fromNow() %></p>
        </div>
        <% if (currentUser && movie.author.id.equals(currentUser._id) || currentUser && currentUser.isAdmin) { %>
            <div class="composition__link">
                <a class="btn btn--white" href="/movies/<%= movie._id %>/edit">Edit</a>
            </div>
            <form class="composition__link" action="/movies/<%= movie._id %>?_method=DELETE" method="POST">
                <button class="btn btn--white">Delete</button>
            </form>
        <% } %>
    </div>
</div>

<div class="movies-comment">
    <a class="btn btn--white btn--comment" href="/movies/<%= movie._id %>/comments/new">Add New Comment</a>
    <% movie.comments.forEach(comment => { %>
        <div class="comment">
            <a class="comment__user u-text-decoration" href="/users/<%= comment.author.id %>"><%= comment.author.username %></a>
            <span class="comment__time"><%= moment(comment.createdAt).fromNow() %></span>
            <div class="comment__body">
                <p class="comment__text"><%= comment.text %></p>
                <% if (currentUser && comment.author.id.equals(currentUser._id) || currentUser && currentUser.isAdmin) { %>
                    <div>
                        <a class="btn btn--white comment__btn" href="/movies/<%= movie._id %>/comments/<%= comment._id %>/edit">Edit Comment</a>
                        <form class="u-inline-block" action="/movies/<%= movie._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
                            <button class="btn btn--black comment__btn u-inline-block">Delete Comment</button>
                        </form>
                    </div>
                <% } %>
                <hr>
            </div>
        </div>
    <% }) %>
</div>

<% include ../partials/footer %>